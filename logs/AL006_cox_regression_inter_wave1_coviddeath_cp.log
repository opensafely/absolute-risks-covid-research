-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/AL006_cox_regression_inter_wave1_coviddeath_cp.log
  log type:  text
 opened on:  25 Feb 2021, 20:21:53

. 
. 
. * Categories of various exposures
. local lo_ldr            = 0

. local hi_ldr            = 1

. local lo_ldr_cat        = 0

. local hi_ldr_cat        = 2

. local hi_ldr            = 1

. local lo_ldr_carecat= 0

. local hi_ldr_carecat= 2

. local lo_ds             = 0

. local hi_ds             = 1

. local lo_cp             = 0

. local hi_cp             = 1

. local lo_ldr_group      = 0

. local hi_ldr_group      = 5

. 
. * Open temporary file to post results
. tempfile ldrfile

. tempname ldrresults

. 
. postfile `ldrresults'   wave str15(outcome) str15(exposure) str20(model)     
>    ///
>                                                 expcat agebroad lnhr sehr usi
> ng `ldrfile'

. 
. 
.         * Open dataset (complete case ethnicity)
.         use "analysis/data_ldanalysis_cohort`i'.dta", clear 
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)

.         drop if ethnicity_5>=.
(12,499 observations deleted)

. 
.         * Only keep data for adults
.         keep if child==0
(7,126 observations deleted)

. 
.         
.         /*  Declare data to be survival  */
. 
.         stset stime_`out'`i', fail(`out'`i') scale(365.25)

     failure event:  coviddeath1 != 0 & coviddeath1 < .
obs. time interval:  (0, stime_coviddeath1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     30,365  total observations
          0  exclusions
------------------------------------------------------------------------------
     30,365  observations remaining, representing
        648  failures in single-record/single-failure data
 14,525.018  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645

. 
.         
.                 
.         /*  Fit Cox models  */
.         
.         * Confounder only model
.         stcox i.`exp'##i.agebroad age1 age2 age3 male i.ethnicity_5,    ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4425.8638
Iteration 2:   log pseudolikelihood = -4424.6561
Iteration 3:   log pseudolikelihood =  -4424.641
Iteration 4:   log pseudolikelihood =  -4424.641
Refining estimates:
Iteration 0:   log pseudolikelihood =  -4424.641

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(13)    =       24.91
Log pseudolikelihood =    -4424.641             Prob > chi2      =      0.0237

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        1.cp |   .9138718   .1106404    -0.74   0.457     .7208289    1.158613
             |
    agebroad |
     65-<75  |   .8760333   .1812795    -0.64   0.522     .5839552    1.314201
        75+  |   .6255657   .2543699    -1.15   0.249     .2819383    1.388007
             |
 cp#agebroad |
   1#65-<75  |   1.353272   .3923752     1.04   0.297     .7666253    2.388841
      1#75+  |   3.190036   .8742001     4.23   0.000     1.864368    5.458327
             |
        age1 |   .9987155   .0240819    -0.05   0.957     .9526139    1.047048
        age2 |   1.007983   .0605422     0.13   0.895     .8960411    1.133911
        age3 |   .9793469   .1547102    -0.13   0.895     .7185712     1.33476
        male |   .9359251   .0713142    -0.87   0.385     .8060882    1.086675
             |
 ethnicity_5 |
      Mixed  |   1.191742   .1502665     1.39   0.164     .9307954    1.525843
Asian or ..  |   1.190894   .1485326     1.40   0.161     .9326276    1.520681
      Black  |   1.104968    .142937     0.77   0.440     .8575109    1.423836
      Other  |   1.122389   .1458469     0.89   0.374     .8700323    1.447942
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")       
>       ///
>                                 ("Confounders")                              
>                            ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders")                      
>                                    ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.cp + 0b.cp#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.cp + 0b.cp#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2124605   .2649653     0.80   0.423    -.3068619    .7317829
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.069967   .2487828     4.30   0.000     .5823618    1.557572
------------------------------------------------------------------------------

.         
.         * Confounders with deprivation
.         stcox i.`exp'##i.agebroad age1 age2 age3 male i.ethnicity_5 imd, ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4425.1879
Iteration 2:   log pseudolikelihood = -4423.9786
Iteration 3:   log pseudolikelihood = -4423.9635
Iteration 4:   log pseudolikelihood = -4423.9635
Refining estimates:
Iteration 0:   log pseudolikelihood = -4423.9635

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(14)    =       25.94
Log pseudolikelihood =   -4423.9635             Prob > chi2      =      0.0264

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        1.cp |   .9138967    .110645    -0.74   0.457     .7208461    1.158648
             |
    agebroad |
     65-<75  |   .8755478   .1813531    -0.64   0.521     .5834044    1.313984
        75+  |    .624504    .254246    -1.16   0.248     .2811881    1.386991
             |
 cp#agebroad |
   1#65-<75  |   1.351217   .3918546     1.04   0.299     .7653769    2.385473
      1#75+  |    3.18725   .8734262     4.23   0.000     1.862752    5.453525
             |
        age1 |   .9987127   .0240794    -0.05   0.957     .9526158     1.04704
        age2 |   1.007908   .0605372     0.13   0.896      .895975    1.133825
        age3 |   .9798063    .154823    -0.13   0.897     .7188505    1.335494
        male |   .9359672   .0713129    -0.87   0.385     .8061319    1.086714
             |
 ethnicity_5 |
      Mixed  |   1.190904   .1502227     1.39   0.166     .9300464    1.524926
Asian or ..  |   1.189354   .1484278     1.39   0.165     .9312874    1.518933
      Black  |   1.103993   .1428083     0.76   0.444     .8567581    1.422573
      Other  |   1.121965   .1458257     0.89   0.376     .8696528    1.447482
             |
         imd |   .9681404   .0271299    -1.16   0.248     .9164007    1.022801
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                                 ("Confounders+IMD")                          
>                    ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }       
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+IMD")                  
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.cp + 0b.cp#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.cp + 0b.cp#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2109676   .2650283     0.80   0.426    -.3084783    .7304134
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.069121   .2487241     4.30   0.000     .5816305    1.556611
------------------------------------------------------------------------------

.         
.         * Confounders with residential care
.         stcox i.`exp'##i.agebroad age1 age2 age3 male   ///
>                                 i.ethnicity_5 resid_care_ldr,           ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4425.8325
Iteration 2:   log pseudolikelihood = -4424.6248
Iteration 3:   log pseudolikelihood = -4424.6097
Iteration 4:   log pseudolikelihood = -4424.6097
Refining estimates:
Iteration 0:   log pseudolikelihood = -4424.6097

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(14)    =       25.35
Log pseudolikelihood =   -4424.6097             Prob > chi2      =      0.0313

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        1.cp |   .9137797   .1106464    -0.74   0.456     .7207298    1.158539
             |
    agebroad |
     65-<75  |     .87637   .1813324    -0.64   0.524     .5842016    1.314656
        75+  |   .6258276   .2544019    -1.15   0.249     .2821222    1.388264
             |
 cp#agebroad |
   1#65-<75  |   1.353501   .3924408     1.04   0.296      .766756    2.389243
      1#75+  |   3.189298    .874254     4.23   0.000     1.863643    5.457924
             |
        age1 |   .9986935   .0240844    -0.05   0.957     .9525872    1.047031
        age2 |   1.008043   .0605522     0.13   0.894     .8960828    1.133992
        age3 |   .9791801   .1546952    -0.13   0.894     .7184325    1.334563
        male |   .9359719   .0713133    -0.87   0.385     .8061361    1.086719
             |
 ethnicity_5 |
      Mixed  |   1.191691   .1502614     1.39   0.164     .9307536    1.525781
Asian or ..  |   1.191238   .1485968     1.40   0.161     .9328644    1.521174
      Black  |   1.105007   .1429457     0.77   0.440     .8575358    1.423895
      Other  |   1.122477   .1458719     0.89   0.374     .8700806    1.448091
             |
resid_care~r |   1.051974   .2055243     0.26   0.795     .7173076    1.542781
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                                 ("Confounders+Resid")                        
>                    ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }               
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+Resid")                
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.cp + 0b.cp#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.cp + 0b.cp#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2125291   .2649565     0.80   0.422    -.3067761    .7318343
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.069635   .2489249     4.30   0.000     .5817513    1.557519
------------------------------------------------------------------------------

.         
.         * Confounders with physical comorbidities that are indicators for vac
> cination 
.         stcox i.`exp'##i.agebroad age1 age2 age3 male           ///
>                                 i.ethnicity_5                                
>                    ///
>                                 obese40                                      
>                            ///
>                                 respiratory asthma_severe                    
>            ///
>                                 cardiac af dvt_pe i.diabcat                  
>            ///
>                                 liver stroke tia dementia                    
>            ///
>                                 i.kidneyfn                                   
>                            ///
>                                 spleen transplant dialysis                   
>            ///
>                                 immunosuppression cancerHaem                 
>    ///
>                                 autoimmune ibd cancerExhaem1yr,              
>    ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -687.13142
Iteration 1:   log pseudolikelihood = -670.39756
Iteration 2:   log pseudolikelihood = -665.56104
Iteration 3:   log pseudolikelihood = -665.09703
Iteration 4:   log pseudolikelihood = -664.93463
Iteration 5:   log pseudolikelihood = -664.87504
Iteration 6:   log pseudolikelihood = -664.85314
Iteration 7:   log pseudolikelihood = -664.84508
Iteration 8:   log pseudolikelihood = -664.84212
Iteration 9:   log pseudolikelihood = -664.84103
Iteration 10:  log pseudolikelihood = -664.84063
Iteration 11:  log pseudolikelihood = -664.84048
Iteration 12:  log pseudolikelihood = -664.84043
Iteration 13:  log pseudolikelihood = -664.84041
Iteration 14:  log pseudolikelihood =  -664.8404
Iteration 15:  log pseudolikelihood =  -664.8404
Iteration 16:  log pseudolikelihood =  -664.8404
Iteration 17:  log pseudolikelihood =  -664.8404
Iteration 18:  log pseudolikelihood =  -664.8404
Iteration 19:  log pseudolikelihood =  -664.8404
Iteration 20:  log pseudolikelihood =  -664.8404
Iteration 21:  log pseudolikelihood = -664.84039
Iteration 22:  log pseudolikelihood = -664.84039
Iteration 23:  log pseudolikelihood = -664.84039
Iteration 24:  log pseudolikelihood = -664.84039
Iteration 25:  log pseudolikelihood = -664.84039
Iteration 26:  log pseudolikelihood = -664.84039
Iteration 27:  log pseudolikelihood = -664.84039
Iteration 28:  log pseudolikelihood = -664.84039
Iteration 29:  log pseudolikelihood = -664.84039
Iteration 30:  log pseudolikelihood = -664.84039
Iteration 31:  log pseudolikelihood = -664.84039
Iteration 32:  log pseudolikelihood = -664.84039
Refining estimates:
Iteration 0:   log pseudolikelihood = -664.84039
Iteration 1:   log pseudolikelihood = -664.84039
Iteration 2:   log pseudolikelihood = -664.84039

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        6,087             Number of obs    =       6,087
No. of failures      =          131
Time at risk         =  2916.769336
                                                Wald chi2(36)    =    55312.16
Log pseudolikelihood =   -664.84039             Prob > chi2      =      0.0000

                         (Std. Err. adjusted for 986 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        1.cp |   .7666279   .1984301    -1.03   0.305      .461598    1.273225
             |
    agebroad |
     65-<75  |   1.169491   .5891419     0.31   0.756     .4357083    3.139045
        75+  |   1.892162   1.833735     0.66   0.511     .2831658    12.64375
             |
 cp#agebroad |
   1#65-<75  |   5.06e-15   2.18e-15   -76.44   0.000     2.18e-15    1.18e-14
      1#75+  |   8.420902   4.990588     3.60   0.000     2.635724    26.90402
             |
        age1 |   .9999114   .0492499    -0.00   0.999     .9078962    1.101252
        age2 |   1.015826   .1226007     0.13   0.896     .8018392    1.286919
        age3 |   .8798772   .2796774    -0.40   0.687     .4719104    1.640532
        male |   .9979857   .1730803    -0.01   0.991     .7103963       1.402
             |
 ethnicity_5 |
      Mixed  |   1.006175   .3143369     0.02   0.984     .5454454    1.856075
Asian or ..  |   1.504357   .4215076     1.46   0.145     .8686641    2.605254
      Black  |   1.341367   .3712316     1.06   0.289     .7797807      2.3074
      Other  |   1.673962   .4852077     1.78   0.076     .9484619    2.954414
             |
     obese40 |   1.238517   .2497841     1.06   0.289     .8341263     1.83896
 respiratory |   1.329002   .2781537     1.36   0.174     .8818066    2.002987
asthma_sev~e |   .8281354   .2513944    -0.62   0.534     .4567776    1.501405
     cardiac |   1.195593   .2388627     0.89   0.371     .8082124    1.768649
          af |    .961793   .2241914    -0.17   0.867     .6090722    1.518779
      dvt_pe |   .8451616   .2114002    -0.67   0.501     .5176412     1.37991
             |
     diabcat |
Controlle..  |   1.265168   .2722549     1.09   0.274     .8298043    1.928948
Uncontrol..  |   .6502947   .3817376    -0.73   0.464     .2057954    2.054872
Diabetes,..  |   8.533661   9.187145     1.99   0.046     1.034549     70.3914
             |
       liver |   .9032541   .2040707    -0.45   0.652     .5800953    1.406438
      stroke |    .980556   .2219444    -0.09   0.931     .6292262    1.528051
         tia |    .960912   .2236548    -0.17   0.864     .6089256    1.516362
    dementia |   .8599199   .1932553    -0.67   0.502     .5535565    1.335839
             |
    kidneyfn |
Stage 3a/..  |   1.711516   1.695476     0.54   0.587     .2455595    11.92904
Stage 4/5..  |   1.288885   .3643094     0.90   0.369     .7406587    2.242902
             |
      spleen |   .9092605   .1665364    -0.52   0.604     .6350176     1.30194
  transplant |   1.070169   .2527692     0.29   0.774        .6736    1.700209
    dialysis |   .7947269   .2588452    -0.71   0.481     .4197384    1.504725
immunosupp~n |   .7379743   .1394133    -1.61   0.108     .5096099    1.068673
  cancerHaem |   .9213984   .0730384    -1.03   0.302     .7888119    1.076271
  autoimmune |   1.033284   .2135432     0.16   0.874     .6891387    1.549291
         ibd |   .8370927   .2121484    -0.70   0.483      .509389    1.375617
cancerExha~r |   1.475887   1.512717     0.38   0.704     .1979748    11.00262
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'") ///
>                         ("Confounders+Comorb")                               
>            ///
>                         (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+Comorb")               
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.cp + 0b.cp#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.cp + 0b.cp#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -33.18262   .3438079   -96.52   0.000    -33.85648   -32.50877
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.864963   .5251245     3.55   0.000      .835738    2.894188
------------------------------------------------------------------------------

.         
.         * All variables
.         stcox i.`exp'##i.agebroad age1 age2 age3 male           ///
>                                 i.ethnicity_5 imd resid_care_ldr             
>    ///
>                                 obese40                                      
>                            ///
>                                 respiratory asthma_severe                    
>            ///
>                                 cardiac af dvt_pe i.diabcat                  
>            ///
>                                 liver stroke tia dementia                    
>            ///
>                                 i.kidneyfn                                   
>                            ///
>                                 spleen transplant dialysis                   
>            ///
>                                 immunosuppression cancerHaem                 
>    ///
>                                 autoimmune ibd cancerExhaem1yr,              
>    ///
>                                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -687.13142
Iteration 1:   log pseudolikelihood = -670.07062
Iteration 2:   log pseudolikelihood = -665.13464
Iteration 3:   log pseudolikelihood = -664.67056
Iteration 4:   log pseudolikelihood =  -664.5082
Iteration 5:   log pseudolikelihood = -664.44862
Iteration 6:   log pseudolikelihood = -664.42673
Iteration 7:   log pseudolikelihood = -664.41867
Iteration 8:   log pseudolikelihood = -664.41571
Iteration 9:   log pseudolikelihood = -664.41462
Iteration 10:  log pseudolikelihood = -664.41422
Iteration 11:  log pseudolikelihood = -664.41407
Iteration 12:  log pseudolikelihood = -664.41402
Iteration 13:  log pseudolikelihood =   -664.414
Iteration 14:  log pseudolikelihood = -664.41399
Iteration 15:  log pseudolikelihood = -664.41399
Iteration 16:  log pseudolikelihood = -664.41399
Iteration 17:  log pseudolikelihood = -664.41399
Iteration 18:  log pseudolikelihood = -664.41399
Iteration 19:  log pseudolikelihood = -664.41399
Iteration 20:  log pseudolikelihood = -664.41399
Iteration 21:  log pseudolikelihood = -664.41399
Iteration 22:  log pseudolikelihood = -664.41399
Iteration 23:  log pseudolikelihood = -664.41399
Iteration 24:  log pseudolikelihood = -664.41399
Iteration 25:  log pseudolikelihood = -664.41399
Iteration 26:  log pseudolikelihood = -664.41399
Iteration 27:  log pseudolikelihood = -664.41399
Iteration 28:  log pseudolikelihood = -664.41399
Iteration 29:  log pseudolikelihood = -664.41399
Iteration 30:  log pseudolikelihood = -664.41399
Iteration 31:  log pseudolikelihood = -664.41399
Iteration 32:  log pseudolikelihood = -664.41399
Iteration 33:  log pseudolikelihood = -664.41399
Iteration 34:  log pseudolikelihood = -664.41399
Iteration 35:  log pseudolikelihood = -664.41399
Iteration 36:  log pseudolikelihood = -664.41399
Iteration 37:  log pseudolikelihood = -664.41399
Refining estimates:
Iteration 0:   log pseudolikelihood = -664.41399
Iteration 1:   log pseudolikelihood = -664.41399
Iteration 2:   log pseudolikelihood = -664.41399

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        6,087             Number of obs    =       6,087
No. of failures      =          131
Time at risk         =  2916.769336
                                                Wald chi2(38)    =    73166.15
Log pseudolikelihood =   -664.41399             Prob > chi2      =      0.0000

                         (Std. Err. adjusted for 986 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        1.cp |   .7707065   .2001504    -1.00   0.316     .4632701    1.282165
             |
    agebroad |
     65-<75  |   1.183722   .5962645     0.33   0.738     .4410444    3.176998
        75+  |     1.9349   1.871932     0.68   0.495     .2905078    12.88722
             |
 cp#agebroad |
   1#65-<75  |   3.41e-17   1.48e-17   -87.71   0.000     1.46e-17    7.97e-17
      1#75+  |   8.351814   4.955027     3.58   0.000       2.6108    26.71702
             |
        age1 |   1.000312    .049357     0.01   0.995      .908104    1.101882
        age2 |   1.014744   .1226556     0.12   0.904     .8006982    1.286009
        age3 |    .881193   .2801683    -0.40   0.691     .4725397    1.643251
        male |   .9982182   .1733574    -0.01   0.992     .7102316    1.402978
             |
 ethnicity_5 |
      Mixed  |   1.007871   .3148366     0.03   0.980     .5463968    1.859094
Asian or ..  |   1.506261    .421263     1.46   0.143      .870644    2.605912
      Black  |   1.346703   .3724048     1.08   0.282     .7832282    2.315555
      Other  |   1.678306   .4857242     1.79   0.074      .951748    2.959513
             |
         imd |   .9979146   .0639018    -0.03   0.974     .8802101    1.131359
resid_care~r |   .6823767   .2586288    -1.01   0.313     .3246451    1.434299
     obese40 |   1.245335   .2507114     1.09   0.276     .8393088    1.847781
 respiratory |   1.328753    .277346     1.36   0.173     .8826244    2.000381
asthma_sev~e |   .8304196   .2520684    -0.61   0.540     .4580585    1.505477
     cardiac |   1.196003   .2386462     0.90   0.370     .8088841    1.768389
          af |   .9647086   .2254131    -0.15   0.878     .6102461    1.525061
      dvt_pe |   .8428249   .2109516    -0.68   0.494     .5160469     1.37653
             |
     diabcat |
Controlle..  |    1.26848   .2730103     1.10   0.269     .8319222    1.934126
Uncontrol..  |   .6526703   .3835932    -0.73   0.468     .2062614    2.065236
Diabetes,..  |   8.656642   9.329687     2.00   0.045     1.047051       71.57
             |
       liver |   .8963806   .2014618    -0.49   0.626     .5770117    1.392516
      stroke |   .9835313   .2227201    -0.07   0.942     .6310069       1.533
         tia |   .9556695   .2215833    -0.20   0.845     .6066617    1.505459
    dementia |   .8549923   .1917554    -0.70   0.485     .5508801    1.326989
             |
    kidneyfn |
Stage 3a/..  |   1.722542   1.701536     0.55   0.582     .2485125    11.93964
Stage 4/5..  |   1.292393   .3655104     0.91   0.364     .7424388    2.249721
             |
      spleen |   .9054973   .1657685    -0.54   0.588     .6324971    1.296331
  transplant |   1.063969   .2516143     0.26   0.793      .669316    1.691323
    dialysis |   .7976854   .2608661    -0.69   0.489      .420208    1.514255
immunosupp~n |    .737238    .139455    -1.61   0.107     .5088568     1.06812
  cancerHaem |   .9224452    .073315    -1.02   0.310     .7893833    1.077936
  autoimmune |   1.028754   .2122279     0.14   0.891     .6866132    1.541385
         ibd |    .841475   .2136313    -0.68   0.497     .5116119    1.384018
cancerExha~r |   1.499052   1.539768     0.39   0.693     .2002144    11.22375
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                         ("All")                                              
>                                    ///
>                         (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )     ///
>                                         ("All")                              
>                                    ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.cp + 0b.cp#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.cp + 0b.cp#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -38.17633   .3447768  -110.73   0.000    -38.85208   -37.50057
------------------------------------------------------------------------------

 ( 1)  1.cp + 1.cp#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.862031   .5240992     3.55   0.000     .8348156    2.889247
------------------------------------------------------------------------------

. 
. postclose `ldrresults'

. 
. use `ldrfile', clear

. 
. 
. *************************
. *  Tidy output for HRs  *
. *************************
. 
. * Outcome
. rename outcome out

. gen outcome     = 1 if out=="coviddeath"

. replace outcome = 2 if out=="covidadmission"
(0 real changes made)

. replace outcome = 3 if out=="composite"
(0 real changes made)

. 
. label define outcome    1 "COVID-19 death"              ///
>                                                 2 "COVID-19 admission"  ///
>                                                 3 "Composite"

. label values outcome outcome

. drop out

. 
. * Exposure
. rename exposure exp

. gen     exposure = 1 if exp=="ldr"
(30 missing values generated)

. replace exposure = 2 if exp=="ldr_cat"
(0 real changes made)

. replace exposure = 3 if exp=="ldr_carecat"
(0 real changes made)

. replace exposure = 4 if exp=="ds"
(0 real changes made)

. replace exposure = 5 if exp=="cp"
(30 real changes made)

. replace exposure = 6 if exp=="ldr_group"
(0 real changes made)

. 
. label define exposure   1 "Learning disability register"        ///
>                                                 2 "LDR Severe vs mild"       
>                    ///
>                                                 3 "LDR by residential care"  
>                    ///
>                                                 4 "Down's syndrome"          
>                            ///
>                                                 5 "Cerebral Palsy"           
>                            ///
>                                                 6 "Combined grouping"        
>                    

. label values exposure exposure                                          

. drop exp

. 
. * Age categories
. label define agebroad   1 "16-<65"              ///
>                                                 2 "65-<75"              ///
>                                                 3 "75+"

. label values agebroad agebroad

. 
. 
. * Categories of exposure
. gen category     = "No"                                         if expcat==0
(15 missing values generated)

. replace category = "Yes"                                        if inlist(exp
> osure, 1, 4, 5) & expcat==1
variable category was str2 now str3
(15 real changes made)

. 
. replace category = "LDR, mild"                          if inlist(exposure, 2
> ) & expcat==1
(0 real changes made)

. replace category = "LDR, profound"                      if inlist(exposure, 2
> ) & expcat==2
(0 real changes made)

. 
. replace category = "LDR, community"             if inlist(exposure, 3) & expc
> at==1
(0 real changes made)

. replace category = "LDR, residential care"      if inlist(exposure, 3) & expc
> at==2
(0 real changes made)

. 
. replace category = "DS but not LDR"             if inlist(exposure, 6) & expc
> at==1
(0 real changes made)

. replace category = "DS and LDR"                         if inlist(exposure, 6
> ) & expcat==2
(0 real changes made)

. replace category = "CP but not LDR"             if inlist(exposure, 6) & expc
> at==3
(0 real changes made)

. replace category = "CP and LDR"                         if inlist(exposure, 6
> ) & expcat==4
(0 real changes made)

. replace category = "LDR with no DS or CP"       if inlist(exposure, 6) & expc
> at==5
(0 real changes made)

. 
. * Model adjustment
. gen     adjustment = 1 if model=="Confounders"
(24 missing values generated)

. replace adjustment = 2 if model=="Confounders+IMD"
(6 real changes made)

. replace adjustment = 3 if model=="Confounders+Resid"
(6 real changes made)

. replace adjustment = 4 if model=="Confounders+Comorb"
(6 real changes made)

. replace adjustment = 5 if model=="All"
(6 real changes made)

. label define adj        1 "Confounders"                                      
>    ///     
>                                         2 "Confounders with IMD"             
>            ///
>                                         3 "Confounders with care"            
>            ///
>                                         4 "Confounders with comorbidities"   
>    ///
>                                         5 "All"

. label values adjustment adj

. drop model

. 
. * Hazard ratio with 95% confidence interval
. gen cl = exp(lnhr - invnorm(0.975)*sehr)

. gen cu = exp(lnhr + invnorm(0.975)*sehr)

. gen hr = exp(lnhr)

. 
. gen hr_ci =   string(round(hr, 0.01)) + " (" ///
>                         + string(round(cl, 0.01)) + ", " ///
>                         + string(round(cu, 0.01)) + ")"

. replace hr_ci = "" if expcat==0
(15 real changes made)

. drop cl cu hr lnhr sehr

. 
. * Put in wide format
. reshape wide hr_ci, i(wave outcome exposure expcat agebroad) j(adjust)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       30   ->       6
Number of variables                   8   ->      11
j variable (5 values)        adjustment   ->   (dropped)
xij variables:
                                  hr_ci   ->   hr_ci1 hr_ci2 ... hr_ci5
-----------------------------------------------------------------------------

. rename hr_ci1 hr_conf

. rename hr_ci2 hr_conf_imd

. rename hr_ci3 hr_conf_resid

. rename hr_ci4 hr_conf_comorb

. 
. 
. order wave outcome exposure agebroad category hr*

. sort wave outcome exposure agebroad expcat

. 
. * Save data
. outsheet using "output/ldcox_inter_wave`i'_`out'_`exp'", replace
(note: file output/ldcox_inter_wave1_coviddeath_cp.out not found)

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/AL006_cox_regression_inter_wave1_coviddeath_cp.log
  log type:  text
 closed on:  25 Feb 2021, 20:22:01
-------------------------------------------------------------------------------
