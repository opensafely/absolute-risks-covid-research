-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/AL006_cox_regression_inter_wave1_coviddeath_ldr_ca
> t.log
  log type:  text
 opened on:  25 Feb 2021, 20:17:23

. 
. 
. * Categories of various exposures
. local lo_ldr            = 0

. local hi_ldr            = 1

. local lo_ldr_cat        = 0

. local hi_ldr_cat        = 2

. local hi_ldr            = 1

. local lo_ldr_carecat= 0

. local hi_ldr_carecat= 2

. local lo_ds             = 0

. local hi_ds             = 1

. local lo_cp             = 0

. local hi_cp             = 1

. local lo_ldr_group      = 0

. local hi_ldr_group      = 5

. 
. * Open temporary file to post results
. tempfile ldrfile

. tempname ldrresults

. 
. postfile `ldrresults'   wave str15(outcome) str15(exposure) str20(model)     
>    ///
>                                                 expcat agebroad lnhr sehr usi
> ng `ldrfile'

. 
. 
.         * Open dataset (complete case ethnicity)
.         use "analysis/data_ldanalysis_cohort`i'.dta", clear 
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)

.         drop if ethnicity_5>=.
(12,499 observations deleted)

. 
.         * Only keep data for adults
.         keep if child==0
(7,126 observations deleted)

. 
.         
.         /*  Declare data to be survival  */
. 
.         stset stime_`out'`i', fail(`out'`i') scale(365.25)

     failure event:  coviddeath1 != 0 & coviddeath1 < .
obs. time interval:  (0, stime_coviddeath1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     30,365  total observations
          0  exclusions
------------------------------------------------------------------------------
     30,365  observations remaining, representing
        648  failures in single-record/single-failure data
 14,525.018  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645

. 
.         
.                 
.         /*  Fit Cox models  */
.         
.         * Confounder only model
.         stcox i.`exp'##i.agebroad age1 age2 age3 male i.ethnicity_5,    ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4429.9374
Iteration 2:   log pseudolikelihood = -4429.6963
Iteration 3:   log pseudolikelihood =  -4429.689
Iteration 4:   log pseudolikelihood =  -4429.689
Refining estimates:
Iteration 0:   log pseudolikelihood =  -4429.689

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(16)    =        9.48
Log pseudolikelihood =    -4429.689             Prob > chi2      =      0.8923

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     ldr_cat |
  LDR, mild  |   .9308678   .0889851    -0.75   0.454     .7718244    1.122684
LDR, prof..  |   .8550343   .1591482    -0.84   0.400     .5936749    1.231455
             |
    agebroad |
     65-<75  |   .9825163   .2176588    -0.08   0.937     .6364604    1.516729
        75+  |   .7766885   .3114619    -0.63   0.529     .3539193    1.704471
             |
     ldr_cat#|
    agebroad |
  LDR, mild #|
     65-<75  |   .9461826   .2591051    -0.20   0.840     .5531969    1.618342
  LDR, mild #|
        75+  |   1.389494   .3969375     1.15   0.250     .7937674    2.432315
LDR, prof.. #|
     65-<75  |   .3561097   .2679546    -1.37   0.170     .0814887    1.556217
LDR, prof.. #|
        75+  |   .7967962   .5000595    -0.36   0.717     .2328861    2.726157
             |
        age1 |   .9992403   .0241467    -0.03   0.975     .9530168    1.047706
        age2 |   1.006214   .0605922     0.10   0.918     .8941961    1.132265
        age3 |   .9850066   .1561404    -0.10   0.924     .7219533    1.343907
        male |   .9368719   .0714024    -0.86   0.392     .8068765    1.087811
             |
 ethnicity_5 |
      Mixed  |   1.191562   .1498915     1.39   0.164     .9311947    1.524729
Asian or ..  |   1.182651   .1474664     1.35   0.178     .9262303    1.510059
      Black  |   1.105505    .143288     0.77   0.439     .8574996    1.425239
      Other  |   1.125024   .1462802     0.91   0.365     .8719367    1.451571
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")       
>       ///
>                                 ("Confounders")                              
>                            ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders")                      
>                                    ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.ldr_cat + 0b.ldr_cat#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.ldr_cat + 0b.ldr_cat#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -.1269577   .2508044    -0.51   0.613    -.6185254    .3646099
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2573014   .2689634     0.96   0.339    -.2698573      .78446
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   -1.18913   .7243753    -1.64   0.101     -2.60888    .2306193
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    -.38377   .6017733    -0.64   0.524    -1.563224    .7956839
------------------------------------------------------------------------------

.         
.         * Confounders with deprivation
.         stcox i.`exp'##i.agebroad age1 age2 age3 male i.ethnicity_5 imd, ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4429.2659
Iteration 2:   log pseudolikelihood = -4429.0248
Iteration 3:   log pseudolikelihood = -4429.0176
Iteration 4:   log pseudolikelihood = -4429.0176
Refining estimates:
Iteration 0:   log pseudolikelihood = -4429.0176

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(17)    =       11.28
Log pseudolikelihood =   -4429.0176             Prob > chi2      =      0.8414

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     ldr_cat |
  LDR, mild  |   .9303803   .0889158    -0.76   0.450     .7714571    1.122042
LDR, prof..  |   .8533986   .1589695    -0.85   0.395     .5923681    1.229454
             |
    agebroad |
     65-<75  |   .9809254   .2173988    -0.09   0.931     .6353124    1.514553
        75+  |   .7758452    .311384    -0.63   0.527     .3533026     1.70374
             |
     ldr_cat#|
    agebroad |
  LDR, mild #|
     65-<75  |     .94796   .2594424    -0.20   0.845     .5544073    1.620881
  LDR, mild #|
        75+  |   1.391398   .3975898     1.16   0.248     .7947341     2.43602
LDR, prof.. #|
     65-<75  |    .359875   .2709121    -1.36   0.175     .0822946    1.573736
LDR, prof.. #|
        75+  |   .7991853   .5012147    -0.36   0.721     .2337817    2.732024
             |
        age1 |   .9992047   .0241452    -0.03   0.974     .9529842    1.047667
        age2 |   1.006248   .0605988     0.10   0.918     .8942186    1.132313
        age3 |   .9850963   .1562108    -0.09   0.925     .7219384    1.344179
        male |   .9369914   .0714151    -0.85   0.393     .8069733    1.087958
             |
 ethnicity_5 |
      Mixed  |   1.190945   .1498548     1.39   0.165     .9306497    1.524043
Asian or ..  |    1.18153   .1473978     1.34   0.181     .9252437    1.508807
      Black  |    1.10488   .1431802     0.77   0.442     .8570553    1.424365
      Other  |    1.12508   .1463058     0.91   0.365     .8719528    1.451691
             |
         imd |   .9682807   .0271188    -1.15   0.250     .9165613    1.022918
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                                 ("Confounders+IMD")                          
>                    ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }       
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+IMD")                  
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.ldr_cat + 0b.ldr_cat#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.ldr_cat + 0b.ldr_cat#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -.1256048    .250679    -0.50   0.616    -.6169266     .365717
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2581472   .2690371     0.96   0.337    -.2691559    .7854503
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -1.180527   .7245738    -1.63   0.103    -2.600666    .2396113
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   -.382691   .6012208    -0.64   0.524    -1.561062    .7956801
------------------------------------------------------------------------------

.         
.         * Confounders with residential care
.         stcox i.`exp'##i.agebroad age1 age2 age3 male   ///
>                                 i.ethnicity_5 resid_care_ldr,           ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -4435.1167
Iteration 1:   log pseudolikelihood = -4429.8964
Iteration 2:   log pseudolikelihood = -4429.6551
Iteration 3:   log pseudolikelihood = -4429.6478
Iteration 4:   log pseudolikelihood = -4429.6478
Refining estimates:
Iteration 0:   log pseudolikelihood = -4429.6478

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =          648
Time at risk         =  14525.01848
                                                Wald chi2(17)    =        9.58
Log pseudolikelihood =   -4429.6478             Prob > chi2      =      0.9204

                       (Std. Err. adjusted for 1,207 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     ldr_cat |
  LDR, mild  |   .9303313   .0888574    -0.76   0.450     .7715037    1.121856
LDR, prof..  |   .8546735   .1590518    -0.84   0.399     .5934643    1.230852
             |
    agebroad |
     65-<75  |    .982847   .2177134    -0.08   0.938     .6366983    1.517183
        75+  |   .7768691   .3114553    -0.63   0.529     .3540723    1.704527
             |
     ldr_cat#|
    agebroad |
  LDR, mild #|
     65-<75  |   .9464334   .2591625    -0.20   0.841     .5533564    1.618733
  LDR, mild #|
        75+  |   1.389955   .3970007     1.15   0.249     .7941075    2.432887
LDR, prof.. #|
     65-<75  |   .3561667   .2679958    -1.37   0.170     .0815025    1.556451
LDR, prof.. #|
        75+  |   .7968138   .5000572    -0.36   0.717      .232899    2.726128
             |
        age1 |   .9992191   .0241491    -0.03   0.974     .9529912    1.047689
        age2 |   1.006272    .060601     0.10   0.917     .8942379    1.132342
        age3 |   .9848448   .1561227    -0.10   0.923     .7218234    1.343707
        male |   .9369423   .0714015    -0.85   0.393     .8069477    1.087878
             |
 ethnicity_5 |
      Mixed  |   1.191524   .1498895     1.39   0.164     .9311603    1.524688
Asian or ..  |   1.183149   .1475652     1.35   0.178      .926564    1.510787
      Black  |    1.10568   .1433237     0.78   0.438     .8576156    1.425498
      Other  |   1.125205   .1463232     0.91   0.364     .8720478    1.451854
             |
resid_care~r |     1.0598   .2071537     0.30   0.766     .7225103    1.554547
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                                 ("Confounders+Resid")                        
>                    ///
>                                 (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }               
  6.                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+Resid")                
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.ldr_cat + 0b.ldr_cat#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.ldr_cat + 0b.ldr_cat#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -.1272692   .2507951    -0.51   0.612    -.6188185    .3642802
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2570566   .2690095     0.96   0.339    -.2701923    .7843056
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -1.189392   .7243647    -1.64   0.101    -2.609121    .2303365
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -.3841699   .6017525    -0.64   0.523    -1.563583    .7952433
------------------------------------------------------------------------------

.         
.         * Confounders with physical comorbidities that are indicators for vac
> cination 
.         stcox i.`exp'##i.agebroad age1 age2 age3 male           ///
>                                 i.ethnicity_5                                
>                    ///
>                                 obese40                                      
>                            ///
>                                 respiratory asthma_severe                    
>            ///
>                                 cardiac af dvt_pe i.diabcat                  
>            ///
>                                 liver stroke tia dementia                    
>            ///
>                                 i.kidneyfn                                   
>                            ///
>                                 spleen transplant dialysis                   
>            ///
>                                 immunosuppression cancerHaem                 
>    ///
>                                 autoimmune ibd cancerExhaem1yr,              
>    ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -687.13142
Iteration 1:   log pseudolikelihood = -683.55423
Iteration 2:   log pseudolikelihood = -672.63378
Iteration 3:   log pseudolikelihood = -671.23498
Iteration 4:   log pseudolikelihood = -671.04891
Iteration 5:   log pseudolikelihood = -671.04101
Iteration 6:   log pseudolikelihood = -671.04098
Refining estimates:
Iteration 0:   log pseudolikelihood = -671.04098

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        6,087             Number of obs    =       6,087
No. of failures      =          131
Time at risk         =  2916.769336
                                                Wald chi2(39)    =       41.33
Log pseudolikelihood =   -671.04098             Prob > chi2      =      0.3694

                         (Std. Err. adjusted for 986 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     ldr_cat |
  LDR, mild  |   .9678529   .1990227    -0.16   0.874      .646806    1.448254
LDR, prof..  |   .4827902   .2488673    -1.41   0.158     .1757857    1.325969
             |
    agebroad |
     65-<75  |   .7550142   .4551152    -0.47   0.641     .2316643    2.460657
        75+  |   3.424671   2.987005     1.41   0.158     .6197249    18.92512
             |
     ldr_cat#|
    agebroad |
  LDR, mild #|
     65-<75  |   1.340242   1.013972     0.39   0.699     .3042278    5.904286
  LDR, mild #|
        75+  |   1.082506   .6469937     0.13   0.894     .3354925    3.492831
LDR, prof.. #|
     65-<75  |   7.224452   7.384407     1.93   0.053     .9744446     53.5615
LDR, prof.. #|
        75+  |   2.099835   2.483709     0.63   0.531     .2067161    21.33026
             |
        age1 |   1.003504   .0490087     0.07   0.943     .9119025    1.104307
        age2 |    1.00686   .1199082     0.06   0.954     .7972567    1.271568
        age3 |   .8991951   .2801343    -0.34   0.733     .4882828    1.655909
        male |   1.010488   .1756383     0.06   0.952      .718752    1.420636
             |
 ethnicity_5 |
      Mixed  |   1.034292   .3200597     0.11   0.913     .5639495    1.896906
Asian or ..  |   1.541813   .4333904     1.54   0.123     .8887224    2.674836
      Black  |   1.370407   .3825903     1.13   0.259     .7928869     2.36858
      Other  |   1.719186   .4987183     1.87   0.062     .9736387    3.035622
             |
     obese40 |   1.238526    .252498     1.05   0.294     .8305598    1.846883
 respiratory |   1.355473   .2859306     1.44   0.149     .8964663    2.049499
asthma_sev~e |   .8445256   .2519057    -0.57   0.571     .4706692    1.515339
     cardiac |   1.187866   .2379481     0.86   0.390     .8021551    1.759042
          af |    .920617   .2125398    -0.36   0.720     .5855513    1.447415
      dvt_pe |   .8353004    .211521    -0.71   0.477     .5085048    1.372114
             |
     diabcat |
Controlle..  |   1.241806   .2731808     0.98   0.325     .8068643    1.911202
Uncontrol..  |   .6469055   .3806848    -0.74   0.459     .2041427    2.049972
Diabetes,..  |   7.851313   8.793626     1.84   0.066     .8741373     70.5188
             |
       liver |   .8987388   .2032516    -0.47   0.637     .5769425    1.400021
      stroke |   .9582688   .2176925    -0.19   0.851     .6139282    1.495743
         tia |    1.00792   .2345705     0.03   0.973     .6387461    1.590464
    dementia |   .8727635    .197438    -0.60   0.547     .5601913    1.359743
             |
    kidneyfn |
Stage 3a/..  |     1.2973   1.336359     0.25   0.801     .1722706    9.769441
Stage 4/5..  |   1.300048   .3672423     0.93   0.353     .7473242    2.261569
             |
      spleen |   .9090614   .1651296    -0.52   0.600     .6367571    1.297815
  transplant |   1.066403   .2504006     0.27   0.784     .6730569    1.689627
    dialysis |   .7870858   .2577616    -0.73   0.465     .4142507    1.495481
immunosupp~n |   .7410963   .1383006    -1.61   0.108     .5140752    1.068372
  cancerHaem |    .912099    .072148    -1.16   0.245     .7811078    1.065057
  autoimmune |   1.054255   .2212109     0.25   0.801     .6987805    1.590562
         ibd |   .8181008   .2073885    -0.79   0.428     .4977683    1.344579
cancerExha~r |   1.506802   1.526944     0.40   0.686     .2067646    10.98085
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'") ///
>                         ("Confounders+Comorb")                               
>            ///
>                         (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )             ///
>                                         ("Confounders+Comorb")               
>                            ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.ldr_cat + 0b.ldr_cat#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.ldr_cat + 0b.ldr_cat#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2601748   .7330272     0.35   0.723    -1.176532    1.696882
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0466033   .5682079     0.08   0.935    -1.067064     1.16027
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.249298   .8766567     1.43   0.154    -.4689173    2.967514
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0136856    1.05983     0.01   0.990    -2.063543    2.090914
------------------------------------------------------------------------------

.         
.         * All variables
.         stcox i.`exp'##i.agebroad age1 age2 age3 male           ///
>                                 i.ethnicity_5 imd resid_care_ldr             
>    ///
>                                 obese40                                      
>                            ///
>                                 respiratory asthma_severe                    
>            ///
>                                 cardiac af dvt_pe i.diabcat                  
>            ///
>                                 liver stroke tia dementia                    
>            ///
>                                 i.kidneyfn                                   
>                            ///
>                                 spleen transplant dialysis                   
>            ///
>                                 immunosuppression cancerHaem                 
>    ///
>                                 autoimmune ibd cancerExhaem1yr,              
>    ///
>                                 strata(stpcode) cluster(household_id) 

         failure _d:  coviddeath1
   analysis time _t:  stime_coviddeath1/365.25

Iteration 0:   log pseudolikelihood = -687.13142
Iteration 1:   log pseudolikelihood =  -683.0134
Iteration 2:   log pseudolikelihood = -672.10943
Iteration 3:   log pseudolikelihood = -670.71637
Iteration 4:   log pseudolikelihood = -670.53144
Iteration 5:   log pseudolikelihood = -670.52363
Iteration 6:   log pseudolikelihood =  -670.5236
Refining estimates:
Iteration 0:   log pseudolikelihood =  -670.5236

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        6,087             Number of obs    =       6,087
No. of failures      =          131
Time at risk         =  2916.769336
                                                Wald chi2(41)    =       43.31
Log pseudolikelihood =    -670.5236             Prob > chi2      =      0.3729

                         (Std. Err. adjusted for 986 clusters in household_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     ldr_cat |
  LDR, mild  |   .9679708    .199038    -0.16   0.874     .6468965    1.448404
LDR, prof..  |   .4787232   .2476276    -1.42   0.154     .1736946    1.319419
             |
    agebroad |
     65-<75  |   .7630151   .4615319    -0.45   0.655     .2331627    2.496935
        75+  |   3.478694   3.034907     1.43   0.153     .6292238    19.23213
             |
     ldr_cat#|
    agebroad |
  LDR, mild #|
     65-<75  |   1.333998   1.010718     0.38   0.704     .3021573    5.889481
  LDR, mild #|
        75+  |   1.081488   .6448269     0.13   0.895     .3361254    3.479705
LDR, prof.. #|
     65-<75  |   7.255171    7.47142     1.92   0.054     .9639957    54.60347
LDR, prof.. #|
        75+  |   2.084276   2.472157     0.62   0.536     .2038666    21.30906
             |
        age1 |    1.00393   .0491437     0.08   0.936     .9120869    1.105022
        age2 |   1.005437    .119999     0.05   0.964     .7957269    1.270416
        age3 |   .9018838    .281297    -0.33   0.741     .4893971    1.662034
        male |   1.011356   .1760224     0.06   0.948     .7190444      1.4225
             |
 ethnicity_5 |
      Mixed  |   1.036096   .3208292     0.11   0.909     .5647079    1.900975
Asian or ..  |   1.543779   .4332774     1.55   0.122      .890608    2.675984
      Black  |   1.374239   .3834892     1.14   0.255     .7952979    2.374625
      Other  |   1.727934   .5003086     1.89   0.059     .9796455    3.047792
             |
         imd |   .9863699   .0640543    -0.21   0.833     .8684868    1.120254
resid_care~r |   .6619436   .2596946    -1.05   0.293     .3068149    1.428123
     obese40 |   1.245777   .2534107     1.08   0.280     .8361663    1.856044
 respiratory |    1.35689   .2859967     1.45   0.148      .897705    2.050952
asthma_sev~e |   .8479104   .2530607    -0.55   0.580     .4723969    1.521924
     cardiac |   1.188459   .2377378     0.86   0.388     .8029918    1.758966
          af |   .9230406   .2137984    -0.35   0.730     .5862219    1.453381
      dvt_pe |   .8325401   .2109468    -0.72   0.469     .5066755    1.367982
             |
     diabcat |
Controlle..  |   1.245199   .2737894     1.00   0.319     .8092452    1.916009
Uncontrol..  |   .6474354   .3813674    -0.74   0.460     .2040808    2.053955
Diabetes,..  |   7.937547    8.90615     1.85   0.065      .880267    71.57448
             |
       liver |   .8916474   .2004353    -0.51   0.610     .5739178    1.385277
      stroke |   .9612421   .2183286    -0.17   0.862     .6158825    1.500264
         tia |   1.003336   .2325163     0.01   0.989     .6370686     1.58018
    dementia |   .8673379   .1958022    -0.63   0.528     .5572228    1.350043
             |
    kidneyfn |
Stage 3a/..  |    1.30183   1.342234     0.26   0.798     .1725577    9.821412
Stage 4/5..  |   1.302828   .3680566     0.94   0.349     .7488889    2.266504
             |
      spleen |    .904116    .164088    -0.56   0.579     .6334897    1.290354
  transplant |   1.057739   .2489663     0.24   0.812     .6668466    1.677764
    dialysis |   .7905883   .2596666    -0.72   0.474      .415313    1.504961
immunosupp~n |   .7393645   .1382245    -1.62   0.106      .512538    1.066574
  cancerHaem |   .9130679   .0724151    -1.15   0.252     .7816181    1.066624
  autoimmune |   1.050326    .219654     0.23   0.814     .6971282    1.582469
         ibd |   .8212491   .2081698    -0.78   0.437     .4997039    1.349699
cancerExha~r |   1.535531   1.557028     0.42   0.672      .210446    11.20409
------------------------------------------------------------------------------
                                                         Stratified by stpcode

.         forvalues k = `lo_`exp'' (1) `hi_`exp'' {
  2.                 capture qui di _b[`k'.`exp']
  3.                 if _rc==0 {
  4.                         post `ldrresults' (`i') ("`out'") ("`exp'")     //
> /
>                         ("All")                                              
>                                    ///
>                         (`k') (1) (_b[`k'.`exp']) (_se[`k'.`exp'])
  5.                 }
  6.                                 forvalues l = 2 (1) 3 {
  7.                         capture qui di _b[`k'.`exp'#`l'.agebroad]
  8.                         if _rc==0 {
  9.                             lincom `k'.`exp' + `k'.`exp'#`l'.agebroad
 10.                                 post `ldrresults' (`i') ("`out'") ("`exp'"
> )     ///
>                                         ("All")                              
>                                    ///
>                                         (`k') (`l') (r(estimate)) (r(se))
 11.                         }
 12.                 }
 13.         }

 ( 1)  0b.ldr_cat + 0b.ldr_cat#2o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  0b.ldr_cat + 0b.ldr_cat#3o.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |          0  (omitted)
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .2556268   .7338328     0.35   0.728    -1.182659    1.693913
------------------------------------------------------------------------------

 ( 1)  1.ldr_cat + 1.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0457849   .5669483     0.08   0.936    -1.065413    1.156983
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#2.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.245082   .8840421     1.41   0.159     -.487609    2.977772
------------------------------------------------------------------------------

 ( 1)  2.ldr_cat + 2.ldr_cat#3.agebroad = 0

------------------------------------------------------------------------------
          _t |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |  -.0022113   1.062527    -0.00   0.998    -2.084726    2.080303
------------------------------------------------------------------------------

. 
. postclose `ldrresults'

. 
. use `ldrfile', clear

. 
. 
. *************************
. *  Tidy output for HRs  *
. *************************
. 
. * Outcome
. rename outcome out

. gen outcome     = 1 if out=="coviddeath"

. replace outcome = 2 if out=="covidadmission"
(0 real changes made)

. replace outcome = 3 if out=="composite"
(0 real changes made)

. 
. label define outcome    1 "COVID-19 death"              ///
>                                                 2 "COVID-19 admission"  ///
>                                                 3 "Composite"

. label values outcome outcome

. drop out

. 
. * Exposure
. rename exposure exp

. gen     exposure = 1 if exp=="ldr"
(45 missing values generated)

. replace exposure = 2 if exp=="ldr_cat"
(45 real changes made)

. replace exposure = 3 if exp=="ldr_carecat"
(0 real changes made)

. replace exposure = 4 if exp=="ds"
(0 real changes made)

. replace exposure = 5 if exp=="cp"
(0 real changes made)

. replace exposure = 6 if exp=="ldr_group"
(0 real changes made)

. 
. label define exposure   1 "Learning disability register"        ///
>                                                 2 "LDR Severe vs mild"       
>                    ///
>                                                 3 "LDR by residential care"  
>                    ///
>                                                 4 "Down's syndrome"          
>                            ///
>                                                 5 "Cerebral Palsy"           
>                            ///
>                                                 6 "Combined grouping"        
>                    

. label values exposure exposure                                          

. drop exp

. 
. * Age categories
. label define agebroad   1 "16-<65"              ///
>                                                 2 "65-<75"              ///
>                                                 3 "75+"

. label values agebroad agebroad

. 
. 
. * Categories of exposure
. gen category     = "No"                                         if expcat==0
(30 missing values generated)

. replace category = "Yes"                                        if inlist(exp
> osure, 1, 4, 5) & expcat==1
(0 real changes made)

. 
. replace category = "LDR, mild"                          if inlist(exposure, 2
> ) & expcat==1
variable category was str2 now str9
(15 real changes made)

. replace category = "LDR, profound"                      if inlist(exposure, 2
> ) & expcat==2
variable category was str9 now str13
(15 real changes made)

. 
. replace category = "LDR, community"             if inlist(exposure, 3) & expc
> at==1
(0 real changes made)

. replace category = "LDR, residential care"      if inlist(exposure, 3) & expc
> at==2
(0 real changes made)

. 
. replace category = "DS but not LDR"             if inlist(exposure, 6) & expc
> at==1
(0 real changes made)

. replace category = "DS and LDR"                         if inlist(exposure, 6
> ) & expcat==2
(0 real changes made)

. replace category = "CP but not LDR"             if inlist(exposure, 6) & expc
> at==3
(0 real changes made)

. replace category = "CP and LDR"                         if inlist(exposure, 6
> ) & expcat==4
(0 real changes made)

. replace category = "LDR with no DS or CP"       if inlist(exposure, 6) & expc
> at==5
(0 real changes made)

. 
. * Model adjustment
. gen     adjustment = 1 if model=="Confounders"
(36 missing values generated)

. replace adjustment = 2 if model=="Confounders+IMD"
(9 real changes made)

. replace adjustment = 3 if model=="Confounders+Resid"
(9 real changes made)

. replace adjustment = 4 if model=="Confounders+Comorb"
(9 real changes made)

. replace adjustment = 5 if model=="All"
(9 real changes made)

. label define adj        1 "Confounders"                                      
>    ///     
>                                         2 "Confounders with IMD"             
>            ///
>                                         3 "Confounders with care"            
>            ///
>                                         4 "Confounders with comorbidities"   
>    ///
>                                         5 "All"

. label values adjustment adj

. drop model

. 
. * Hazard ratio with 95% confidence interval
. gen cl = exp(lnhr - invnorm(0.975)*sehr)

. gen cu = exp(lnhr + invnorm(0.975)*sehr)

. gen hr = exp(lnhr)

. 
. gen hr_ci =   string(round(hr, 0.01)) + " (" ///
>                         + string(round(cl, 0.01)) + ", " ///
>                         + string(round(cu, 0.01)) + ")"

. replace hr_ci = "" if expcat==0
(15 real changes made)

. drop cl cu hr lnhr sehr

. 
. * Put in wide format
. reshape wide hr_ci, i(wave outcome exposure expcat agebroad) j(adjust)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       45   ->       9
Number of variables                   8   ->      11
j variable (5 values)        adjustment   ->   (dropped)
xij variables:
                                  hr_ci   ->   hr_ci1 hr_ci2 ... hr_ci5
-----------------------------------------------------------------------------

. rename hr_ci1 hr_conf

. rename hr_ci2 hr_conf_imd

. rename hr_ci3 hr_conf_resid

. rename hr_ci4 hr_conf_comorb

. 
. 
. order wave outcome exposure agebroad category hr*

. sort wave outcome exposure agebroad expcat

. 
. * Save data
. outsheet using "output/ldcox_inter_wave`i'_`out'_`exp'", replace
(note: file output/ldcox_inter_wave1_coviddeath_ldr_cat.out not found)

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/AL006_cox_regression_inter_wave1_coviddeath_ldr_ca
> t.log
  log type:  text
 closed on:  25 Feb 2021, 20:17:30
-------------------------------------------------------------------------------
