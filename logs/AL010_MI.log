--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research\logs/AL010_MI.log
  log type:  text
 opened on:  22 Apr 2021, 14:53:57

. 
. 
. 
. /*  Adults  */
. 
. forvalues i = 1 (1) 2 {
  2. local i = 1
  3. 
.         * Open dataset
.         use "analysis/data_ldanalysis_cohort`i'.dta", clear 
  4. 
.         * Only keep data for adults
.         keep if child==0
  5.         
.         * Ethnicity variable
.         drop ethnicity_16
  6.         replace ethnicity_5 = . if ethnicity_5>=.
  7.         
.         foreach out in covidadmission coviddeath {
  8.                         
.                 /*  Declare data to be survival  */
. 
.                 stset stime_`out'`i', fail(`out'`i') scale(365.25)
  9. 
.                 * Obtain Nelson-Aalen estimate of Cumulative Hazard
.                 sts generate cumh_`out' = na
 10.                 egen cumhgp_`out' = cut(cumh_`out'), group(5)
 11.                 replace cumhgp_`out' = cumhgp_`out' + 1
 12.                 
.         }
 13.         
.         mi set wide
 14.         mi register imputed ethnicity_5
 15. 
.         * Check estimated cumulative hazards are non-missing
.         count if cumhgp_coviddeath>=.
 16.         replace cumhgp_coviddeath = 0 if cumhgp_coviddeath==.
 17.         count if cumhgp_covidadmission>=.
 18.         replace cumhgp_covidadmission = 0 if cumhgp_covidadmission==.
 19. 
.         * Check relevant variables are fully observed 
.         recode asthma_severe .=0
 20.         foreach var of varlist region_7                         ///
>                 cumhgp_coviddeath cumhgp_covidadmission ///
>                 coviddeath`i' covidadmission`i'                         ///
>                 ldr_cat resid_care_ldr ds cp                            ///
>                 age1 age2 age3 male obese40                             ///
>                 respiratory asthma_severe                                       ///
>                 cardiac af dvt_pe diabcat                                       ///
>                 liver stroke tia dementia                                       ///
>                 kidneyfn                                                                        ///
>                 spleen transplant dialysis                                      ///
>                 immunosuppression cancerHaem                            ///
>                 autoimmune ibd cancerExhaem1yr {
 21.                         assert `var'<.
 22.         }
 23.                 
.         
.         * Multinomial logistic regression model for ethnicity
.         mi impute mlogit ethnicity i.region_7                   ///
>                 i.cumhgp_coviddeath     i.cumhgp_covidadmission ///
>                 coviddeath`i' covidadmission`i'                         ///
>                 i.ldr_cat resid_care_ldr ds cp                          ///
>                 age1 age2 age3 male obese40                             ///
>                 respiratory asthma_severe                                       ///
>                 cardiac af dvt_pe i.diabcat                                     ///
>                 liver stroke tia dementia                                       ///
>                 i.kidneyfn                                                                      ///
>                 spleen transplant dialysis                                      ///
>                 immunosuppression i.cancerHaem                          ///
>                 autoimmune ibd cancerExhaem1yr,                         ///
>                 add(10) rseed(3040985)
 24.                 
.         * Save imputed dataset
.         save "analysis/data_ldanalysis_cohort`i'_MI.dta", replace 
 25. 
. }
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)
(9,597 observations deleted)
(10,135 real changes made, 10,135 to missing)

     failure event:  covidadmission1 != 0 & covidadmission1 < .
obs. time interval:  (0, stime_covidadmission1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     40,397  total observations
          0  exclusions
------------------------------------------------------------------------------
     40,397  observations remaining, representing
      3,476  failures in single-record/single-failure data
  18,614.22  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645
(40,397 real changes made)

     failure event:  coviddeath1 != 0 & coviddeath1 < .
obs. time interval:  (0, stime_coviddeath1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     40,397  total observations
          0  exclusions
------------------------------------------------------------------------------
     40,397  observations remaining, representing
        751  failures in single-record/single-failure data
 19,461.046  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645
(40,397 real changes made)
  0
(0 real changes made)
  0
(0 real changes made)
(asthma_severe: 32328 changes made)

Univariate imputation                       Imputations =       10
Multinomial logistic regression                   added =       10
Imputed: m=1 through m=10                       updated =        0

------------------------------------------------------------------
                   |               Observations per m             
                   |----------------------------------------------
          Variable |   Complete   Incomplete   Imputed |     Total
-------------------+-----------------------------------+----------
       ethnicity_5 |      30262        10135     10135 |     40397
------------------------------------------------------------------
(complete + incomplete = total; imputed is the minimum across m
 of the number of filled-in observations.)
(note: file analysis/data_ldanalysis_cohort1_MI.dta not found)
file analysis/data_ldanalysis_cohort1_MI.dta saved
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)
(9,597 observations deleted)
(10,135 real changes made, 10,135 to missing)

     failure event:  covidadmission1 != 0 & covidadmission1 < .
obs. time interval:  (0, stime_covidadmission1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     40,397  total observations
          0  exclusions
------------------------------------------------------------------------------
     40,397  observations remaining, representing
      3,476  failures in single-record/single-failure data
  18,614.22  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645
(40,397 real changes made)

     failure event:  coviddeath1 != 0 & coviddeath1 < .
obs. time interval:  (0, stime_coviddeath1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     40,397  total observations
          0  exclusions
------------------------------------------------------------------------------
     40,397  observations remaining, representing
        751  failures in single-record/single-failure data
 19,461.046  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645
(40,397 real changes made)
  0
(0 real changes made)
  0
(0 real changes made)
(asthma_severe: 32328 changes made)

Univariate imputation                       Imputations =       10
Multinomial logistic regression                   added =       10
Imputed: m=1 through m=10                       updated =        0

------------------------------------------------------------------
                   |               Observations per m             
                   |----------------------------------------------
          Variable |   Complete   Incomplete   Imputed |     Total
-------------------+-----------------------------------+----------
       ethnicity_5 |      30262        10135     10135 |     40397
------------------------------------------------------------------
(complete + incomplete = total; imputed is the minimum across m
 of the number of filled-in observations.)
file analysis/data_ldanalysis_cohort1_MI.dta saved

. 
. 
. /*  Children  */
. 
. forvalues i = 1 (1) 2 {
  2. 
. 
.         * Open dataset 
.         use "analysis/data_ldanalysis_cohort`i'.dta", clear 
  3. 
.         * Only keep data for children
.         keep if child==1
  4.         
.         
.         
. }
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)
(40,397 observations deleted)
(Analysis dataset, wave 2 (1 Sept 20 - 3 March 21), for learning disability work)
(36,905 observations deleted)

. 
. log close
      name:  <unnamed>
       log:  C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research\logs/AL010_MI.log
  log type:  text
 closed on:  22 Apr 2021, 14:54:15
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
