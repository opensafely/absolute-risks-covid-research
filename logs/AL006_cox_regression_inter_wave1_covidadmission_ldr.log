---------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research\logs/AL006_cox_regression_i
> nter_wave1_covidadmission_ldr.log
  log type:  text
 opened on:  24 Feb 2021, 18:36:58

. 
. 
. * Categories of various exposures
. local lo_ldr            = 0

. local hi_ldr            = 1

. local lo_ldr_cat        = 0

. local hi_ldr_cat        = 2

. local hi_ldr            = 1

. local lo_ldr_carecat= 0

. local hi_ldr_carecat= 2

. local lo_ds             = 0

. local hi_ds             = 1

. local lo_cp             = 0

. local hi_cp             = 1

. local lo_ldr_group      = 0

. local hi_ldr_group      = 5

. 
. * Open temporary file to post results
. tempfile ldrfile

. tempname ldrresults

. 
. postfile `ldrresults'   wave str15(outcome) str15(exposure) str20(model)        ///
>                                                 expcat agebroad lnhr sehr using `ldrfile'

. 
. 
.         * Open dataset (complete case ethnicity)
.         use "analysis/data_ldanalysis_cohort`i'.dta", clear 
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for learning disability work)

.         drop if ethnicity_5>=.
(12,499 observations deleted)

. 
.         * Only keep data for adults
.         keep if child==0
(7,126 observations deleted)

. 
.         
.         /*  Declare data to be survival  */
. 
.         stset stime_`out'`i', fail(`out'`i') scale(365.25)

     failure event:  covidadmission1 != 0 & covidadmission1 < .
obs. time interval:  (0, stime_covidadmission1]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     30,365  total observations
          0  exclusions
------------------------------------------------------------------------------
     30,365  observations remaining, representing
      2,991  failures in single-record/single-failure data
 13,799.439  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645

. 
.         
.         /*  Create broad age strata  */
.         
.         * Broad age strata
.         drop agebroad

.         gen agebroad = 1 if age<50
(14,173 missing values generated)

.         recode agebroad .=2 if age < 75
(agebroad: 11014 changes made)

.         recode agebroad .=3 if age < .
(agebroad: 3159 changes made)

.         
.         capture label drop agebroad

.         label define agebroad   1 "16-<50"              ///
>                                                         2 "50-<75"              ///
>                                                         3 "75+"

.         label values agebroad agebroad

.                 
.                 
.         /*  Fit Cox models  */
.         
.         * Confounder only model
.         stcox i.`exp'##i.agebroad age1 age2 age3 male i.ethnicity_5,    ///
>                 strata(stpcode) cluster(household_id) 

         failure _d:  covidadmission1
   analysis time _t:  stime_covidadmission1/365.25

Iteration 0:   log pseudolikelihood = -20307.744
Iteration 1:   log pseudolikelihood = -20302.365
Iteration 2:   log pseudolikelihood = -20302.362
Iteration 3:   log pseudolikelihood = -20302.362
Refining estimates:
Iteration 0:   log pseudolikelihood = -20302.362

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =        2,991
Time at risk         =  13799.43874
                                                Wald chi2(13)    =       10.58
Log pseudolikelihood =   -20302.362             Prob > chi2      =      0.6461

                                  (Std. Err. adjusted for 1,207 clusters in household_id)
-----------------------------------------------------------------------------------------
                        |               Robust
                     _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                  1.ldr |   .9509024   .0479266    -1.00   0.318     .8614585    1.049633
                        |
               agebroad |
                50-<75  |   1.081321    .108293     0.78   0.435     .8886028    1.315835
                   75+  |   1.049635   .1747828     0.29   0.771     .7573529    1.454717
                        |
           ldr#agebroad |
              1#50-<75  |   .9997929    .083352    -0.00   0.998     .8490749    1.177265
                 1#75+  |   .9970795   .1296178    -0.02   0.982     .7728153    1.286423
                        |
                   age1 |   1.004223   .0133648     0.32   0.752     .9783671    1.030762
                   age2 |   .9831725   .0354385    -0.47   0.638      .916111    1.055143
                   age3 |   1.044162    .094827     0.48   0.634     .8739067    1.247588
                   male |   .9852559   .0356372    -0.41   0.681     .9178266    1.057639
                        |
            ethnicity_5 |
                 Mixed  |   1.067618    .059189     1.18   0.238     .9576908    1.190164
Asian or Asian British  |   .9740147   .0549276    -0.47   0.641     .8720949    1.087846
                 Black  |   .9461056   .0530554    -0.99   0.323     .8476298    1.056022
                 Other  |   .9302324   .0558298    -1.21   0.228     .8269988    1.046353
-----------------------------------------------------------------------------------------
                                                         Stratified by stpcode

. 
end of do-file

. * Confounder only model

. 
. stcox i.`exp'#i.agebroad age1 age2 age3 male i.ethnicity_5, strata(stpcode) cluster(household_id)
# invalid name
r(198);

. stcox i.ldr#i.agebroad age1 age2 age3 male i.ethnicity_5, strata(stpcode) cluster(household_id)

         failure _d:  covidadmission1
   analysis time _t:  stime_covidadmission1/365.25

Iteration 0:   log pseudolikelihood = -20307.744
Iteration 1:   log pseudolikelihood = -20302.365
Iteration 2:   log pseudolikelihood = -20302.362
Iteration 3:   log pseudolikelihood = -20302.362
Refining estimates:
Iteration 0:   log pseudolikelihood = -20302.362

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =       30,365             Number of obs    =      30,365
No. of failures      =        2,991
Time at risk         =  13799.43874
                                                Wald chi2(13)    =       10.58
Log pseudolikelihood =   -20302.362             Prob > chi2      =      0.6461

                                  (Std. Err. adjusted for 1,207 clusters in household_id)
-----------------------------------------------------------------------------------------
                        |               Robust
                     _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
           ldr#agebroad |
              0#50-<75  |   1.081321    .108293     0.78   0.435     .8886028    1.315835
                 0#75+  |   1.049635   .1747828     0.29   0.771     .7573529    1.454717
              1#16-<50  |   .9509024   .0479266    -1.00   0.318     .8614585    1.049633
              1#50-<75  |   1.028018   .1062987     0.27   0.789     .8394309    1.258972
                 1#75+  |   .9951858   .1814486    -0.03   0.979     .6961578    1.422658
                        |
                   age1 |   1.004223   .0133648     0.32   0.752     .9783671    1.030762
                   age2 |   .9831725   .0354385    -0.47   0.638      .916111    1.055143
                   age3 |   1.044162    .094827     0.48   0.634     .8739067    1.247588
                   male |   .9852559   .0356372    -0.41   0.681     .9178266    1.057639
                        |
            ethnicity_5 |
                 Mixed  |   1.067618    .059189     1.18   0.238     .9576908    1.190164
Asian or Asian British  |   .9740147   .0549276    -0.47   0.641     .8720949    1.087846
                 Black  |   .9461056   .0530554    -0.99   0.323     .8476298    1.056022
                 Other  |   .9302324   .0558298    -1.21   0.228     .8269988    1.046353
-----------------------------------------------------------------------------------------
                                                         Stratified by stpcode

