---------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research\logs/AAR002_risk_by_age_wav
> e1_covidadmission.log
  log type:  text
 opened on:  17 Feb 2021, 13:55:04

. 
. 
.         
. ****************
. *   Open data  *
. ****************
. 
. use "analysis/data_aranalysis_cohort`i'.dta", replace   
(Analysis dataset, wave 1 (1 Mar - 31 Aug 20), for absolute risk work)

. drop if ethnicity_5>=.
(0 observations deleted)

. drop ethnicity_16

. rename ethnicity_5 ethnicity

. rename region_7 region

. 
. * Keep under 50s only
. drop if age>=50
(11,126 observations deleted)

. 
. 
. /*  Declare data to be survival  */
. 
. stset stime_`out'`i'_nocensor, fail(`out'`i'_nocensor) ///
>         scale(365.25) id(patient_id)

                id:  patient_id
     failure event:  covidadmission1_nocensor != 0 & covidadmission1_nocensor < .
obs. time interval:  (stime_covidadmission1_nocensor[_n-1], stime_covidadmission1_nocensor]
 exit on or before:  failure
    t for analysis:  time/365.25

------------------------------------------------------------------------------
     12,472  total observations
          0  exclusions
------------------------------------------------------------------------------
     12,472  observations remaining, representing
     12,472  subjects
      1,285  failures in single-failure-per-subject data
  5,961.391  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  .5037645

. 
. 
. 
. 
.         
. ********************************
. *   Fit Royston-Parmar model   *
. ********************************
. 
. 
. * Create dummy variables for categorical predictors 
. foreach var of varlist obesecat smoke_nomiss imd        ///
>         asthmacat diabcat cancerExhaem cancerHaem               ///
>         kidneyfn region ethnicity                                               ///
>         {
  2.                 egen ord_`var' = group(`var')
  3.                 qui summ ord_`var'
  4.                 local max=r(max)
  5.                 forvalues i = 1 (1) `max' {
  6.                         gen `var'_`i' = (`var'==`i')
  7.                 }       
  8.                 drop ord_`var'
  9.                 drop `var'_1
 10. }
(9,992 missing values generated)

. 
. 
. timer clear 1

. timer on 1

. stpm2   age1 age2 age3                  ///
>                 ethnicity_*                             ///
>                 obesecat_*                              ///
>                 smoke_nomiss_*                  ///
>                 imd_*                                   ///
>                 hypertension                    ///
>                 respiratory                             ///
>                 cf                                              ///
>                 asthmacat_*                             ///
>                 cardiac                                 ///
>                 diabcat_*                               ///
>                 af                                              ///
>                 dvt_pe                                  ///
>                 pad                                             ///
>                 cancerExhaem_*                  ///
>                 cancerHaem_*                    ///
>                 liver                                   ///
>                 stroke                                  ///
>                 dementia                                ///
>                 tia                                             ///
>                 neuro                                   ///
>                 kidneyfn_*                              ///
>                 transplant                              ///
>                 dialysis                                ///
>                 spleen                                  ///
>                 autoimmune                      ///
>                 ibd                                             ///
>                 immunosuppression               ///
>                 smi                                             ///
>                 ds                                              ///
>                 ldr                                             ///
>                 region_*                                ///
>                 if male==`j',                   ///
>                 scale(hazard) df(10) eform lininit
note: kidneyfn_2 dropped because of collinearity
Initial Values Obtained

Iteration 0:   log likelihood = -2658.7522  
Iteration 1:   log likelihood = -2650.7785  
Iteration 2:   log likelihood = -2650.2773  
Iteration 3:   log likelihood = -2650.2763  
Iteration 4:   log likelihood = -2650.2763  

Log likelihood = -2650.2763                     Number of obs     =      6,209

-----------------------------------------------------------------------------------
                  |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
xb                |
             age1 |    1.02674   .0134534     2.01   0.044     1.000707     1.05345
             age2 |   .8191706   .0872388    -1.87   0.061     .6648511    1.009309
             age3 |    3.80078    4.94486     1.03   0.305     .2967901    48.67389
      ethnicity_2 |   1.082176   .1337155     0.64   0.523     .8494194    1.378713
      ethnicity_3 |   .9256052   .1188111    -0.60   0.547     .7197226    1.190382
      ethnicity_4 |    1.08617   .1347305     0.67   0.505     .8517521    1.385104
      ethnicity_5 |   .9667659   .1214878    -0.27   0.788     .7557111    1.236764
       obesecat_2 |     .66047   .1516117    -1.81   0.071     .4211713    1.035732
       obesecat_3 |   .6921928   .1663569    -1.53   0.126     .4321705    1.108662
       obesecat_4 |   .7719589   .1832548    -1.09   0.276     .4847613    1.229307
       obesecat_5 |   .6835237   .1608439    -1.62   0.106     .4309753    1.084064
   smoke_nomiss_2 |   .5325342   .2030212    -1.65   0.098     .2522545    1.124233
   smoke_nomiss_3 |   .9919869   .1218025    -0.07   0.948      .779812    1.261891
            imd_2 |   .8687512   .1120816    -1.09   0.275     .6746491    1.118698
            imd_3 |   .9872178   .1245641    -0.10   0.919      .770923    1.264198
            imd_4 |   1.117621   .1351337     0.92   0.358     .8818079    1.416495
            imd_5 |   .9573373   .1217161    -0.34   0.732     .7461789    1.228251
     hypertension |   .9319382   .0954501    -0.69   0.491     .7624408    1.139116
      respiratory |   1.049253   .1029726     0.49   0.624     .8656533    1.271792
               cf |   1.026405   .1016714     0.26   0.792     .8452834    1.246337
      asthmacat_2 |   1.319153   .3090465     1.18   0.237     .8334486     2.08791
      asthmacat_3 |   1.556351   .3565528     1.93   0.054     .9933471     2.43845
          cardiac |   .8078037   .0870369    -1.98   0.048      .654023    .9977428
        diabcat_2 |    .721292   .0884481    -2.66   0.008     .5671956    .9172534
        diabcat_3 |   1.197686   .2334701     0.93   0.355     .8173622    1.754976
        diabcat_4 |   2.25e-08   .0002031    -0.00   0.998            0           .
               af |   .9533065   .0994873    -0.46   0.647     .7769642    1.169672
           dvt_pe |   .9978116   .0991784    -0.02   0.982     .8211879    1.212424
              pad |    1.06364   .0876577     0.75   0.454     .9049915    1.250099
   cancerExhaem_2 |   1.169795   .5293618     0.35   0.729     .4818586     2.83988
   cancerExhaem_3 |   .9696982   .2554869    -0.12   0.907     .5785889    1.625186
   cancerExhaem_4 |   .9532504   .0830674    -0.55   0.583     .8035858    1.130789
     cancerHaem_2 |   .5026985   .5041633    -0.69   0.493     .0704086    3.589133
     cancerHaem_3 |   .8566626   .3063301    -0.43   0.665     .4250426    1.726582
     cancerHaem_4 |   1.013405   .1052093     0.13   0.898     .8268242    1.242089
            liver |   1.018542   .1031492     0.18   0.856     .8351733    1.242171
           stroke |   .9235566   .0946963    -0.78   0.438     .7554158    1.129122
         dementia |    1.04351   .1034225     0.43   0.667     .8592785    1.267242
              tia |   1.017205   .1027111     0.17   0.866     .8345639    1.239817
            neuro |   .9363157   .0955016    -0.65   0.519     .7666588    1.143517
       kidneyfn_3 |    .948334   .1322388    -0.38   0.704      .721551    1.246395
       transplant |   1.003425    .108346     0.03   0.975     .8120367    1.239922
         dialysis |   1.004669   .1573922     0.03   0.976      .739049    1.365755
           spleen |   1.013271   .0840388     0.16   0.874     .8612484    1.192127
       autoimmune |   1.229372   .1174357     2.16   0.031     1.019465    1.482499
              ibd |   .9355461   .0958549    -0.65   0.516     .7653359    1.143611
immunosuppression |    .997396   .1009608    -0.03   0.979     .8179096     1.21627
              smi |   .8740392   .0913429    -1.29   0.198     .7121553    1.072722
               ds |   .8155535   .0874325    -1.90   0.057     .6609952    1.006252
              ldr |   .9950872   .0813643    -0.06   0.952     .8477383    1.168048
         region_2 |   1.172702    .187179     1.00   0.318     .8576787    1.603433
         region_3 |   1.118855    .171622     0.73   0.464     .8283379    1.511264
         region_4 |   1.095778   .1777943     0.56   0.573     .7972813    1.506029
         region_5 |   .9450782    .182568    -0.29   0.770     .6471942    1.380069
         region_6 |   1.095637   .2002958     0.50   0.617     .7656965     1.56775
            _rcs1 |   1.540824   .0280443    23.75   0.000     1.486827    1.596782
            _rcs2 |    1.02421   .0146139     1.68   0.094     .9959644    1.053257
            _rcs3 |   .9783628   .0078625    -2.72   0.006     .9630732    .9938951
            _rcs4 |   1.000884   .0045404     0.19   0.846     .9920242    1.009822
            _rcs5 |   .9962451   .0032126    -1.17   0.243     .9899683    1.002562
            _rcs6 |    .997282   .0022083    -1.23   0.219     .9929631     1.00162
            _rcs7 |   .9997474   .0017041    -0.15   0.882     .9964129    1.003093
            _rcs8 |   1.001765   .0013158     1.34   0.179     .9991897    1.004348
            _rcs9 |   .9988274   .0009584    -1.22   0.221     .9969507    1.000708
           _rcs10 |   .9993498   .0006954    -0.93   0.350     .9979877    1.000714
            _cons |   .0750803    .034021    -5.71   0.000     .0308903    .1824862
-----------------------------------------------------------------------------------
Note: Estimates are transformed only in the first equation.

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      6,209          .  -2650.276      66   5432.553    5876.98
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] BIC note.

. timer off 1

. timer list 1
   1:      5.24 /        1 =       5.2380

.                         
. 
. 
. 
. *****************************************************
. *   Survival predictions from Royston-Parmar model  *
. *****************************************************
. 
. * Predict absolute risk at 90 days
. gen time90 = 90

. predict surv90_royp, surv timevar(time90)

. gen risk90_royp = 1-surv90_royp

. drop surv90_royp

. 
. /*  Quantiles of predicted day risk   */
. 
. centile risk90_royp, c(50 70 80 90)

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
 risk90_royp |    12,472         50           1               1           1
             |                   70           1               1           1
             |                   80           1               1           1
             |                   90           1               1           1

. 
. global p50 = r(c_1) 

. global p70 = r(c_2) 

. global p80 = r(c_3) 

. global p90 = r(c_4) 

. 
. 
. 
. 
. *********************************************************
. *   Obtain predicted risks by comorbidity with 95% CIs  *
. *********************************************************
. 
. * Collapse data to one row per age (i.e. per year)
. bysort age: keep if _n==1
(12,440 observations deleted)

. 
. * Keep only variables needed for the risk prediction
. keep age age? _rcs1- _d_rcs5  _st _d _t _t0

. 
. * Sex
. gen male = `j'

. 
. * Set time to 90 days (for the risk prediction period)
. gen time90 = 90

. 
. 
. 
. /*  Initially set values to "no comorbidity"  */
. 
. 
. foreach var in                                                                                          ///
>         hypertension respiratory cf asthmacat_2 asthmacat_3     ///
>         cardiac diabcat_2 diabcat_3     diabcat_4 af dvt_pe pad         ///     
>         cancerExhaem_2 cancerExhaem_3 cancerExhaem_4                    ///
>         cancerHaem_2 cancerHaem_3 cancerHaem_4                                  ///
>         liver stroke dementia tia neuro                                                 ///
>         kidneyfn_2 kidneyfn_3 transplant dialysis                               ///
>         spleen autoimmune ibd immunosuppression                                 ///
>         smi ldr ds      {
  2.         gen `var' = 0
  3. }

. 
. 
. /*  Non-smoker, non-obese, middle IMD, White, Midlands  */
. 
. 
. foreach var in                                                                                          ///
>         ethnicity_2 ethnicity_3 ethnicity_4 ethnicity_5                 ///
>         smoke_nomiss_2 smoke_nomiss_3                                                   ///                      
>         obesecat_2 obesecat_3 obesecat_4 obesecat_5                             ///
>         imd_2 imd_3 imd_4 imd_5                                                                 ///
>         region_2 region_3 region_4 region_5 region_6 region_7   {
  2.         gen `var' = 0
  3. }

. replace imd_3    = 1 
(32 real changes made)

. replace region_3 = 1
(32 real changes made)

. 
. 
. 
. /*  Predict survival at 90 days under each comorbidity separately   */
. 
. * Set age and sex to baseline values
. gen cons = 0

. 
. foreach var of varlist cons                                                     ///
>                 respiratory cf asthmacat_2 asthmacat_3                  ///
>                 cardiac diabcat_2 diabcat_3 diabcat_4                   ///
>                 hypertension af dvt_pe pad                                              ///     
>                 cancerExhaem_2 cancerExhaem_3 cancerExhaem_4    ///
>                 cancerHaem_2 cancerHaem_3 cancerHaem_4                  ///
>                 liver stroke dementia tia neuro                                 ///
>                 kidneyfn_2 kidneyfn_3 transplant dialysis               ///
>                 spleen autoimmune ibd immunosuppression                 ///
>                 smi ldr ds                                                                              ///
>                 {
  2.                                 
.         * Reset that value to "yes"
.         replace `var' = 1
  3.         
.         * Predict under that comorbidity (age and sex left at original values)
.         predict pred_`var', surv timevar(time90) ci
  4.         
.         * Change to risk, not survival
.         gen risk_`var' = 1 - pred_`var'
  5.         gen risk_`var'_uci = 1 - pred_`var'_lci
  6.         gen risk_`var'_lci = 1 - pred_`var'_uci
  7.         drop pred_`var' pred_`var'_lci pred_`var'_uci
  8.         
.         * Reset that value back to "no"
.         replace `var' = 0
  9. }
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 missing values generated)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)
(32 real changes made)

. 
. keep age male risk*

. 
. 
. * Save relevant percentiles
. gen p50 = $p50 

. gen p70 = $p70 

. gen p80 = $p80 

. gen p90 = $p90 

. 
. 
. * Save data
. outsheet using "output/ar_wave`i'_male`j'_`out'.out", replace
(note: file output/ar_wave_male1_covidadmission.out not found)

. 
. 
. 
. 
. 
. 
. *****************************
. *  Graph all comorbidities  *
. *****************************                   
. 
. * Graph title and labelling
. *local opts = "ylab(0 (0.001) 0.009, angle(0)) xlab(20 (20) 50) xmtick(20 (5) 50)"
.         
. local wave1 = "Wave 1"

. local wave2 = "Wave 2"

. local male0 = "Female"

. local male1 = "Male"

. 
. 
. * Risk 
. qui summ risk_cons if age==50 

. gen risk_age_50 = r(mean) 
(32 missing values generated)

. 
. 
. * All comorbidities
. sort age

. twoway  (line risk_respiratory                  age, lwidth(vthin) lcolor(eltblue))                                             ///
>                 (line risk_cf                                   age, lwidth(vthin) lcolor(eltblue) lpattern(dash))                   
>    ///
>                 (line risk_asthmacat_2                  age, lwidth(vthin) lcolor(blue))                                             
>            ///
>                 (line risk_asthmacat_3                  age, lwidth(vthin) lcolor(midblue))                                          
>    ///
>                 (line risk_hypertension                 age, lwidth(vthin) lcolor(olive_teal))                                       
>    ///
>                 (line risk_cardiac                              age, lwidth(vthin) lcolor(mint))                                     
>                    ///
>                 (line risk_diabcat_2                    age, lwidth(vthin) lcolor(midgreen))                                         
>    ///
>                 (line risk_diabcat_3                    age, lwidth(vthin) lcolor(green))                                            
>            ///
>                 (line risk_diabcat_4                    age, lwidth(vthin) lcolor(dkgreen))                                          
>    ///
>                 (line risk_liver                                age, lwidth(vthin) lcolor(olive))                                    
>                    ///
>                 (line risk_kidneyfn_2                   age, lwidth(vthin) lcolor(stone))                                            
>            ///
>                 (line risk_kidneyfn_3                   age, lwidth(vthin) lcolor(sand))                                             
>            ///
>                 (line risk_transplant                   age, lwidth(vthin) lcolor(sienna))                                           
>    ///
>                 (line risk_dialysis                             age, lwidth(vthin) lcolor(sienna*0.7))                               
>            ///
>                 (line risk_stroke                               age, lwidth(vthin) lcolor(pink))                                     
>                    ///
>                 (line risk_dementia                     age, lwidth(vthin) lcolor(pink) lpattern(dash))                         ///
>                 (line risk_tia                                  age, lwidth(vthin) lcolor(pink) lpattern(dot))                       
>    ///
>                 (line risk_neuro                                age, lwidth(vthin) lcolor(maroon))                                   
>                    ///
>                 (line risk_cancerExhaem_2               age, lwidth(vthin) lcolor(gs3) lpattern(dash))                          ///
>                 (line risk_cancerExhaem_3               age, lwidth(vthin) lcolor(gs5) lpattern(dash))                          ///
>                 (line risk_cancerExhaem_4               age, lwidth(vthin) lcolor(gs7) lpattern(dash))                          ///
>                 (line risk_cancerHaem_2                 age, lwidth(vthin) lcolor(sandb) lpattern(dash))                        ///
>                 (line risk_cancerHaem_3                 age, lwidth(vthin) lcolor(gold)         lpattern(dash))                 ///
>                 (line risk_cancerHaem_4                 age, lwidth(vthin) lcolor(yellow)       lpattern(dash))                 ///
>                 (line risk_spleen                               age, lwidth(vthin) lcolor(orange_red)  lpattern(dot))           ///
>                 (line risk_autoimmune                   age, lwidth(vthin) lcolor(magenta))                                          
>    ///
>                 (line risk_ibd                                  age, lwidth(vthin) lcolor(magenta))                                  
>            ///
>                 (line risk_immunosuppression    age, lwidth(vthin) lcolor(red) lpattern(dash))                          ///
>                 (line risk_smi                                  age, lwidth(vthin) lcolor(red) lpattern(dash))                       
>    ///
>                 (line risk_ldr                                  age, lwidth(vthin) lcolor(red) lpattern(dash))                       
>    ///
>                 (line risk_ds                                   age, lwidth(vthin) lcolor(red) lpattern(dash))                       
>    ///
>                 (line risk_cons                                 age, lwidth(vthin) lcolor(black))                                    
>                    ///
>                 (line risk_age_50                               age, lpattern(dot) lcolor(black))                                    
>                    ///
>                 ,       xlab(20 (20) 50) xmtick(20 (5) 50)                                                                           
>                                    /// 
>                 subtitle("`male`j'', `wave`i''")                                                                                     
>                                    ///
>                 legend(order(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31) ///
>                 size(tiny) col(4)                                       ///
>                 label(1 "Respiratory")                          ///
>                 label(2 "CF")                                           ///
>                 label(3 "Asthma mild")                          ///
>                 label(4 "Asthma sev")                           ///
>                 label(5 "Hypertension")                         ///
>                 label(6 "Cardiac")                                      ///
>                 label(7 "Diab, control")                        /// 
>                 label(8 "Diab, uncontrol")              ///
>                 label(9 "Diab, unknown")                        ///
>                 label(10 "Liver")                                       ///
>                 label(11 "Red kidney")                          ///
>                 label(12 "Poor kidney")                         ///
>                 label(13 "Transplant")                          ///
>                 label(14 "Dialysis")                            ///
>                 label(15 "Stroke")                                      ///
>                 label(16 "Dementia")                            ///
>                 label(17 "TIA")                                         ///
>                 label(18 "Neurological")                        ///
>                 label(19 "Canc. Oth (<1yr)")            ///
>                 label(20 "Canc. Oth (2-4yr)")           ///
>                 label(21 "Canc. Oth (5+yr)")            ///
>                 label(22 "Canc. Haem (<1yr)")           ///
>                 label(23 "Canc. Haem (2-4yr)")          ///
>                 label(24 "Canc. Haem (5+yr)")           ///
>                 label(25 "Spleen")                                      ///
>                 label(26 "RA/SLE/psoriasis")            ///
>                 label(27 "Immunosuppression")           ///
>                 label(28 "SMI")                                         ///
>                 label(29 "Learning disability")         ///
>                 label(30 "Down's Syndrome")             ///
>                 label(31 "No comorbidity")                      ///
>                 colfirst) 

.         graph export output/ar_wave`i'_male`j'_`out'.svg, as(svg) replace width(1600)
(note: file output/ar_wave_male1_covidadmission.svg not found)
(file output/ar_wave_male1_covidadmission.svg written in SVG format)

. }
} is not a valid command name
r(199);

end of do-file

r(199);

. do "C:\Users\emsuewil\AppData\Local\Temp\STD20f8_000000.tmp"

. ********************************************************************************
. *
. *       Do-file:                AAR002_1_risk_by_age.do
. *
. *       Programmed by:  Fizz & Krishnan
. *
. *       Data used:              analysis/data_aranalysis_cohort`i'.dta
. *
. *       Data created:   analysis/ar_wave`i'_male`j'_`outcome.out
. *
. *       Other output:   Log file:  logs/AAR002_1_risk_by_age
. *                                       output/ar_wave`i'_male`j'_`outcome'.svg
. *
. ********************************************************************************
. *
. *       Purpose:                This do-file performs survival analysis using Royston-Parmar
. *                                       flexible hazard modelling. 
. *
. *                                       These analyses will be helpful in considering how 
. *                                       comorbidities and demographic factors affect risk, 
. *                                       comparatively.
. *  
. ********************************************************************************
. *       
. *       Stata routines needed:   stpm2 (which needs rcsgen)       
. *
. ********************************************************************************
. 
. 
. 
. **********************
. *  Input parameters  *
. **********************
. 
. local wave              `1'

. local male              `2'

. local outcome   `3'

. 
. local i = `wave'
invalid syntax
r(198);

end of do-file

r(198);

. do "analysis/AAR002_risk_by_age.do" 2 0 covidadmission

. ********************************************************************************
. *
. *       Do-file:                AAR002_1_risk_by_age.do
. *
. *       Programmed by:  Fizz & Krishnan
. *
. *       Data used:              analysis/data_aranalysis_cohort`i'.dta
. *
. *       Data created:   analysis/ar_wave`i'_male`j'_`outcome.out
. *
. *       Other output:   Log file:  logs/AAR002_1_risk_by_age
. *                                       output/ar_wave`i'_male`j'_`outcome'.svg
. *
. ********************************************************************************
. *
. *       Purpose:                This do-file performs survival analysis using Royston-Parmar
. *                                       flexible hazard modelling. 
. *
. *                                       These analyses will be helpful in considering how 
. *                                       comorbidities and demographic factors affect risk, 
. *                                       comparatively.
. *  
. ********************************************************************************
. *       
. *       Stata routines needed:   stpm2 (which needs rcsgen)       
. *
. ********************************************************************************
. 
. 
. 
. **********************
. *  Input parameters  *
. **********************
. 
. local wave              `1'

. local male              `2'

. local outcome   `3'

. 
. local i = `wave'

. local j = `male'

. local out = "`outcome'"

. 
. 
. noi di "Wave:" `i'
Wave:2

. noi di "Male (1=yes, 0=no):" `j'
Male (1=yes, 0=no):0

. noi di "Outcome: `out'"
Outcome: covidadmission

. 
. 
. **************************
. *  Adopath and log file  *
. **************************
. 
. adopath ++ `c(pwd)'/analysis/ado
  [1]              "C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research/analysis/ado"
  [2]              "C:\Users\emsuewil\Documents\Work\Covid\OpenSAFELY\Absolute_risks\absolute-risks-covid-research/analysis"
  [3]              "C:\Users\emsuewil\Documents/analysis"
  [4]  (BASE)      "C:\Program Files\Stata16\ado\base/"
  [5]  (SITE)      "C:\Program Files\Stata16\ado\site/"
  [6]              "."
  [7]  (PERSONAL)  "C:\Users\emsuewil\ado\personal/"
  [8]  (PLUS)      "C:\Users\emsuewil\ado\plus/"
  [9]  (OLDPLACE)  "c:\ado/"

. 
. * Open a log file
. capture log close
